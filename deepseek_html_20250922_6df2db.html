<!DOCTYPE html>
<html>
<head>
    <title>NFT Trade Bot</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 400px; margin: 0 auto; }
        .btn { width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 10px; background: #2481cc; color: white; cursor: pointer; }
        .btn-wallet { background: #0088cc; }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .btn-secondary { background: #6c757d; }
        .form-group { margin: 15px 0; }
        input, textarea { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        .section { display: none; background: white; padding: 20px; border-radius: 10px; margin: 10px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .wallet-info { background: #e8f4fd; padding: 15px; border-radius: 8px; margin: 10px 0; }
        .wallet-address { font-family: monospace; word-break: break-all; }
        .balance { font-size: 24px; font-weight: bold; color: #0088cc; text-align: center; margin: 10px 0; }
        .wallet-list { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .wallet-item { padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .wallet-item:hover { border-color: #2481cc; background: #f0f8ff; }
        .wallet-icon { font-size: 24px; margin-bottom: 5px; }
        .back-btn { background: #6c757d; }
        .hidden { display: none; }
        .status-connected { color: #28a745; font-weight: bold; }
        .status-disconnected { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h2 style="text-align: center; color: #2481cc;">üéÅ NFT Trade Bot</h2>
        
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="mainMenu" class="section active">
            <button class="btn" onclick="showSection('createForm')">üéÅ –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>
            <button class="btn" onclick="showSection('tradesList')">üìã –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–¥–µ–ª–∫–∏</button>
            <button class="btn btn-wallet" onclick="showWalletSection()">üëõ –ú–æ–π –∫–æ—à–µ–ª–µ–∫</button>
            <button class="btn" onclick="showSection('balanceSection')">üíé –ë–∞–ª–∞–Ω—Å</button>
        </div>
        
        <!-- –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è -->
        <div id="createForm" class="section">
            <h3>üéÅ –°–æ–∑–¥–∞—Ç—å NFT –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</h3>
            <div class="form-group">
                <input type="text" id="nftName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ NFT" required>
            </div>
            <div class="form-group">
                <textarea id="nftDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ NFT" rows="3"></textarea>
            </div>
            <div class="form-group">
                <input type="number" id="nftPrice" placeholder="–¶–µ–Ω–∞ –≤ TON" step="0.001" min="0.001" required>
            </div>
            <button class="btn" onclick="createTrade()">‚úÖ –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>
            <button class="btn back-btn" onclick="showMainMenu()">üîô –ù–∞–∑–∞–¥</button>
        </div>
        
        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–æ–º -->
        <div id="walletSection" class="section">
            <h3>üëõ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ TON –∫–æ—à–µ–ª—å–∫–æ–º</h3>
            
            <div id="walletConnected" class="wallet-info hidden">
                <h4>‚úÖ –ö–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω</h4>
                <p><strong>–ê–¥—Ä–µ—Å:</strong> <span id="walletAddress" class="wallet-address"></span></p>
                <p><strong>–ë–∞–ª–∞–Ω—Å:</strong> <span id="walletBalance" class="balance">0 TON</span></p>
                <p><strong>–¢–∏–ø:</strong> <span id="walletType"></span></p>
                <button class="btn btn-danger" onclick="disconnectWallet()">‚ùå –û—Ç–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</button>
                <button class="btn" onclick="checkBalance()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
            </div>
            
            <div id="walletDisconnected">
                <h4>üîó –ü–æ–¥–∫–ª—é—á–∏—Ç–µ TON –∫–æ—à–µ–ª–µ–∫</h4>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –∫–æ—à–µ–ª–µ–∫ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:</p>
                
                <div class="wallet-list">
                    <div class="wallet-item" onclick="connectWallet('telegram')">
                        <div class="wallet-icon">üì±</div>
                        <div>Telegram Wallet</div>
                    </div>
                    <div class="wallet-item" onclick="connectWallet('tonkeeper')">
                        <div class="wallet-icon">üëõ</div>
                        <div>Tonkeeper</div>
                    </div>
                    <div class="wallet-item" onclick="connectWallet('tonhub')">
                        <div class="wallet-icon">‚ö°</div>
                        <div>Tonhub</div>
                    </div>
                    <div class="wallet-item" onclick="connectWallet('mytonwallet')">
                        <div class="wallet-icon">üíé</div>
                        <div>MyTonWallet</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <button class="btn" onclick="connectWallet('tonconnect')">üîó TonConnect (–≤—Å–µ –∫–æ—à–µ–ª—å–∫–∏)</button>
                </div>
                
                <div class="wallet-info">
                    <h5>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h5>
                    <ol>
                        <li>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –∫–æ—à–µ–ª–µ–∫</li>
                        <li>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</li>
                        <li>–ì–æ—Ç–æ–≤–æ! –ú–æ–∂–Ω–æ —Ç–æ—Ä–≥–æ–≤–∞—Ç—å NFT</li>
                    </ol>
                </div>
            </div>
            
            <button class="btn back-btn" onclick="showMainMenu()">üîô –ù–∞–∑–∞–¥</button>
        </div>
        
        <!-- –ë–∞–ª–∞–Ω—Å -->
        <div id="balanceSection" class="section">
            <h3>üíé –ë–∞–ª–∞–Ω—Å TON</h3>
            <div id="balanceInfo">
                <p>–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫ —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –±–∞–ª–∞–Ω—Å</p>
            </div>
            <button class="btn" onclick="showWalletSection()">üëõ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–æ–º</button>
            <button class="btn back-btn" onclick="showMainMenu()">üîô –ù–∞–∑–∞–¥</button>
        </div>
        
        <!-- –°–ø–∏—Å–æ–∫ —Å–¥–µ–ª–æ–∫ -->
        <div id="tradesList" class="section">
            <h3>üìã –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–¥–µ–ª–∫–∏</h3>
            <div id="tradesContainer">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–¥–µ–ª–æ–∫...</p>
            </div>
            <button class="btn back-btn" onclick="showMainMenu()">üîô –ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = window.Telegram.WebApp;
        let tonConnect = null;
        let currentWallet = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        tg.expand();
        tg.MainButton.setText("–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é").onClick(showMainMenu).show();
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            loadWalletState();
            checkUrlParameters();
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
        function checkUrlParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const action = urlParams.get('action');
            
            if (action === 'connect_wallet') {
                showWalletSection();
            } else if (action === 'send_ton') {
                showSendTonSection();
            } else if (action === 'receive_ton') {
                showReceiveTonSection();
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }
        
        function showMainMenu() {
            showSection('mainMenu');
        }
        
        function showWalletSection() {
            showSection('walletSection');
            updateWalletDisplay();
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–æ–º
        function loadWalletState() {
            const savedWallet = localStorage.getItem('ton_wallet');
            if (savedWallet) {
                currentWallet = JSON.parse(savedWallet);
                updateWalletDisplay();
            }
        }
        
        function saveWalletState() {
            if (currentWallet) {
                localStorage.setItem('ton_wallet', JSON.stringify(currentWallet));
            } else {
                localStorage.removeItem('ton_wallet');
            }
        }
        
        function updateWalletDisplay() {
            const connectedDiv = document.getElementById('walletConnected');
            const disconnectedDiv = document.getElementById('walletDisconnected');
            
            if (currentWallet) {
                connectedDiv.classList.remove('hidden');
                disconnectedDiv.style.display = 'none';
                
                document.getElementById('walletAddress').textContent = 
                    currentWallet.address.substring(0, 8) + '...' + currentWallet.address.substring(currentWallet.address.length - 6);
                document.getElementById('walletBalance').textContent = (currentWallet.balance || 0) + ' TON';
                document.getElementById('walletType').textContent = currentWallet.type || 'Unknown';
            } else {
                connectedDiv.classList.add('hidden');
                disconnectedDiv.style.display = 'block';
            }
        }
        
        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ (—Å–∏–º—É–ª—è—Ü–∏—è - –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ TonConnect)
        function connectWallet(walletType) {
            // –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ —Å–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ—à–µ–ª–µ–∫
            const demoWallets = {
                'telegram': { name: 'Telegram Wallet', type: 'telegram' },
                'tonkeeper': { name: 'Tonkeeper', type: 'tonkeeper' },
                'tonhub': { name: 'Tonhub', type: 'tonhub' },
                'mytonwallet': { name: 'MyTonWallet', type: 'mytonwallet' },
                'tonconnect': { name: 'TonConnect', type: 'tonconnect' }
            };
            
            const walletInfo = demoWallets[walletType] || { name: 'Unknown', type: 'other' };
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–µ–º–æ-–∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞
            const demoAddress = 'EQ' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
            const demoBalance = (Math.random() * 100).toFixed(3);
            
            currentWallet = {
                address: demoAddress,
                type: walletType,
                name: walletInfo.name,
                balance: demoBalance,
                connectedAt: new Date().toISOString()
            };
            
            saveWalletState();
            updateWalletDisplay();
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–∞
            const walletData = {
                type: 'wallet_connected',
                wallet_address: currentWallet.address,
                wallet_type: currentWallet.type,
                wallet_name: currentWallet.name,
                balance: currentWallet.balance,
                proof: 'demo_proof_' + Date.now()
            };
            
            tg.showPopup({
                title: '‚úÖ –ö–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω',
                message: `–ö–æ—à–µ–ª–µ–∫ ${walletInfo.name} —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω!\n–ë–∞–ª–∞–Ω—Å: ${demoBalance} TON`,
                buttons: [{ type: 'ok' }]
            });
            
            // tg.sendData(JSON.stringify(walletData));
        }
        
        // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
        function disconnectWallet() {
            tg.showPopup({
                title: '–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞',
                message: '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫?',
                buttons: [
                    { 
                        type: 'destructive', 
                        text: '‚ùå –û—Ç–∫–ª—é—á–∏—Ç—å',
                        id: 'disconnect'
                    },
                    { 
                        type: 'cancel', 
                        text: '–û—Ç–º–µ–Ω–∞',
                        id: 'cancel'
                    }
                ]
            }, function(buttonId) {
                if (buttonId === 'disconnect') {
                    const disconnectData = {
                        type: 'disconnect_wallet',
                        wallet_address: currentWallet.address
                    };
                    
                    currentWallet = null;
                    saveWalletState();
                    updateWalletDisplay();
                    
                    // tg.sendData(JSON.stringify(disconnectData));
                    
                    tg.showPopup({
                        title: '‚úÖ –ö–æ—à–µ–ª–µ–∫ –æ—Ç–∫–ª—é—á–µ–Ω',
                        message: '–ö–æ—à–µ–ª–µ–∫ —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω',
                        buttons: [{ type: 'ok' }]
                    });
                }
            });
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
        function checkBalance() {
            if (!currentWallet) return;
            
            // –°–∏–º—É–ª—è—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
            const newBalance = (parseFloat(currentWallet.balance) + (Math.random() * 2 - 1)).toFixed(3);
            currentWallet.balance = Math.max(0, newBalance);
            saveWalletState();
            updateWalletDisplay();
            
            tg.showPopup({
                title: 'üîÑ –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω',
                message: `–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: ${currentWallet.balance} TON`,
                buttons: [{ type: 'ok' }]
            });
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏
        function createTrade() {
            const nftName = document.getElementById('nftName').value;
            const nftDesc = document.getElementById('nftDesc').value;
            const nftPrice = document.getElementById('nftPrice').value;
            
            if (!nftName || !nftPrice) {
                tg.showPopup({
                    title: '‚ùå –û—à–∏–±–∫–∞',
                    message: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É NFT',
                    buttons: [{ type: 'ok' }]
                });
                return;
            }
            
            if (!currentWallet) {
                tg.showPopup({
                    title: '‚ùå –ö–æ—à–µ–ª–µ–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω',
                    message: '–ü–æ–¥–∫–ª—é—á–∏—Ç–µ TON –∫–æ—à–µ–ª–µ–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è',
                    buttons: [
                        { 
                            type: 'default', 
                            text: 'üëõ –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫',
                            id: 'connect'
                        },
                        { 
                            type: 'cancel', 
                            text: '–û—Ç–º–µ–Ω–∞',
                            id: 'cancel'
                        }
                    ]
                }, function(buttonId) {
                    if (buttonId === 'connect') {
                        showWalletSection();
                    }
                });
                return;
            }
            
            const tradeData = {
                type: 'create_trade',
                nft_name: nftName,
                nft_description: nftDesc,
                price: parseFloat(nftPrice),
                wallet_address: currentWallet.address
            };
            
            tg.sendData(JSON.stringify(tradeData));
            
            tg.showPopup({
                title: '‚úÖ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ',
                message: `NFT "${nftName}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ!\n–¶–µ–Ω–∞: ${nftPrice} TON`,
                buttons: [{ type: 'ok' }]
            });
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('nftName').value = '';
            document.getElementById('nftDesc').value = '';
            document.getElementById('nftPrice').value = '';
            
            showMainMenu();
        }
        
        // –ü–æ–∫–∞–∑ –±–∞–ª–∞–Ω—Å–∞
        function showBalance() {
            showSection('balanceSection');
            const balanceInfo = document.getElementById('balanceInfo');
            
            if (currentWallet) {
                balanceInfo.innerHTML = `
                    <div class="wallet-info">
                        <h4>üíé –í–∞—à –±–∞–ª–∞–Ω—Å</h4>
                        <div class="balance">${currentWallet.balance} TON</div>
                        <p>–ê–¥—Ä–µ—Å: ${currentWallet.address.substring(0, 8)}...${currentWallet.address.substring(currentWallet.address.length - 6)}</p>
                        <p>–ö–æ—à–µ–ª–µ–∫: ${currentWallet.name}</p>
                    </div>
                `;
            } else {
                balanceInfo.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 48px;">üëõ</div>
                        <h4>–ö–æ—à–µ–ª–µ–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω</h4>
                        <p>–ü–æ–¥–∫–ª—é—á–∏—Ç–µ TON –∫–æ—à–µ–ª–µ–∫ —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –±–∞–ª–∞–Ω—Å</p>
                    </div>
                `;
            }
        }
        
        // –ü–æ–∫–∞–∑ —Å–ø–∏—Å–∫–∞ —Å–¥–µ–ª–æ–∫
        function showTrades() {
            showSection('tradesList');
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å–¥–µ–ª–æ–∫
        }
    </script>
</body>
</html>
